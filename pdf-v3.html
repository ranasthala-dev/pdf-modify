<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">


    <title>Document</title>
    <style>
        /* layout */
        html,
        body {
            /* display: flex; */
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            background-color: #F7F7F7;
            font-family: "Roboto", sans-serif;
            font-size: 16px;
            color: #4d4e55;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        li,
        ul,
        a {
            text-decoration: none;
            padding: 0;
            margin: 0;
        }




        .container {
            display: flex;
            padding: 10px;
            height: 100%;
            width: 100%;
        }

        .nav {
            background-color: #F7F7F7;
            padding-top: 10px;
            padding-bottom: 10px;
            width: 200px;
            display: flex;
            flex-direction: column;
        }

        .main-container {
            height: 100%;
            width: 100%;
            padding: 10px;
            overflow: hidden;
            /* Hide default scroll */
        }

        .main {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            background-color: #FFFDFC;
            border: 0.7px solid #ece8e8;
            /* border: 0.7px solid rgb(5, 6, 45); */
            border-radius: 10px;
        }

        .logo {
            font-size: 20px;
        }

        .nav ul li {
            padding-left: 25px;
            padding-top: 20px;
        }

        .bx {
            padding-right: 10px;
        }

        .methods {
            padding: 5px;
            text-align: left;
            width: 100%;
            color: #4d4e55;
            border: none;
            border: 0.7px solid transparent;
            background-color: #F7F7F7;
            border-radius: 10px;
            font-weight: bold;
        }

        .methods:hover {
            background-color: #FFFDFC;
            border: 0.7px solid #ece8e8;
        }

        /* From Uiverse.io by cssbuttons-io */
        .methods {
            align-items: center;
            /* background-image: linear-gradient(144deg, #af40ff, #5b42f3 50%, #00ddeb); */
            background-image: linear-gradient(144deg, #131213, #1e70db 50%, #150232);
            border-radius: 8px;
            box-shadow: rgba(149, 107, 197, 0.2) 0 15px 30px -5px;
            box-sizing: border-box;
            color: #ffffff;
            display: flex;
            /* font-size: 18px; */
            justify-content: center;
            /* line-height: 1em; */
            max-width: 100%;
            /* min-width: 140px; */
            text-decoration: none;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
        }

        .methods:active,
        .methods:hover {
            outline: 0;
        }

        .methods span {
            background-color: rgb(5, 6, 45);
            border-radius: 6px;
            padding: 5px;
            width: 100%;
            height: 100%;
            transition: 300ms;
        }

        .methods:hover span {
            background: none;
        }

        .methods:active {
            transform: scale(0.9);
            /* Shrink shadow too */
        }

        /* end */

        .git {
            display: flex;
            /* justify-content: center; */
            align-items: center;
            margin-top: auto;
            height: 10%;
            width: 100%;
            background-color: #FFFDFC;
            border: 0.7px solid #ece8e8;
            /* border: 0.7px solid rgb(5, 6, 45); */

            border-radius: 10px;
            padding-left: 5px;
        }

        .pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            /* border: 1px solid rgb(5, 6, 45); */
        }

        .git-name {
            padding-left: 6px;
            color: rgb(5, 6, 45);
            font-weight: bold;

        }

        /* main body */

        /* nav bar */
        .nav-bar {
            display: flex;
            width: 100%;
            justify-content: flex-end;
            /* Push content to right */
            align-items: end;
        }

        .nav-list {
            display: flex;
            gap: 20px;
            width: 100%;
            justify-content: flex-end;
            list-style: none;
            margin: 0;
            padding: 10px 20px;
            /* background-color: #1e70db; */
            border-radius: 10px 10px 0 0;
        }

        .nav-button {
            border: none;
            color: rgb(5, 6, 45);
            background-color: #FFFDFC;
            font-weight: bold;
            padding: 5px;
            cursor: pointer;
            /* transition: 0.3s; */

        }

        .nav-button:hover {
            background-color: rgb(5, 6, 45);
            color: #FFFDFC;
            border-radius: 8px;
        }


        .nav-button :active,
        .nav-button :hover {
            outline: 0;
        }

        .nav-button:active {
            transform: scale(0.9);
        }


        /* uploads */

        /* vertical - preview */

        .uploads-container {
            height: 100%;
            width: 100%;
            overflow-y: auto;
        }

        .view {
            display: none;
        }

        .vertical-preview {
            display: block;
            /* default */
        }


        .vertical-preview {
            height: 100%;
            width: 100%;

        }

        .uploads {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
        }

        .upload-box1 {
            display: flex;
            height: 100%;
            padding-top: 25px;
            padding-bottom: 50px;

        }

        .upload-box2 {
            display: flex;
            height: 100%;
            padding-top: 25px;
            padding-bottom: 50px;
        }

        #file1 {
            display: none;
        }

        #file2 {
            display: none;
        }



        .round-upload {
            width: 40px;
            height: 40px;
            margin: 10px;
            /* background: linear-gradient(135deg, #6a11cb, #00050e); */
            background: linear-gradient(135deg, #1e70db, rgb(5, 6, 45));

            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }

        .round-upload:hover {
            transform: scale(1.1);
        }

        .vertical-preview-box {
            width: 400px;
            padding: 16px;
            overflow-y: auto;
            overflow-x: hidden;
            /* border: 1px solid rgb(196, 192, 192); */
            /* border: 1px solid rgb(196, 192, 192); */
            border: 0.7px solid #ece8e8;
            background-color: #f1f1f1;
            border-radius: 7px;
            height: 100%
                /* border-right: 1px solid #ccc; */
        }

        /* notfication */
        .notification {
            position: fixed;
            bottom: 50px;
            right: 50px;
            background-color: #323232;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 9999;
        }

        .notification.show {
            opacity: 1;
        }

        canvas {
            border: 1px solid #ccc;
            cursor: pointer;
            position: relative;
        }

        .selected {
            outline: 3px solid #007bff;
        }

        .selection-badge {
            position: absolute;
            background: #007bff;
            color: white;
            font-size: 14px;
            padding: 2px 6px;
            border-radius: 50%;
            top: 8px;
            left: 8px;
            z-index: 10;
        }

        .canvas-wrapper {
            position: relative;
            display: inline-block;
        }



        .docs-container {
            display: flex;
            /* justify-content: center; */
            align-items: center;
            flex-direction: column;
            padding-bottom: 10px;
            width: 100%;
        }



        .docs-inner {
            border: 0.7px solid #ece8e8;
            /* background-color: #f1f1f1; */
            background-color: #FFFDFC;

            border-radius: 7px;
            padding: 20px;
            width: 80%;
        }

        .docs-box {
            display: flex;
        }



        .horiontal-preview {
            padding: 20px;
        }


        .horiontal-preview #file3 {
            margin-bottom: 20px;
        }

        #file3 {
            display: none;
        }

        .horiontal-preview .container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 100px;
            border: 2px dashed #ccc;
            padding: 10px;
            background: #fff;
        }


        .horiontal-preview .page-box {
            border: 2px solid #3B82F6;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            cursor: grab;
            width: 120px;
        }

        .horiontal-preview .page-box.dragging {
            opacity: 0.5;
        }

        .horiontal-preview canvas {
            display: block;
            width: 100%;
        }

        .horiontal-preview button {
            margin-top: 20px;
            padding: 10px 20px;
            background: #2563EB;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Add specific overflow handling for docs-view */
        .docs-view {
            overflow-y: auto;
            /* Show scroll only when content overflows */
            overflow-x: hidden;
        }

        .docs-view::-webkit-scrollbar {
            width: 8px;
        }

        .docs-view::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .docs-view::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .docs-view::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Other views should not scroll */
        .vertical-preview,
        .horizontal-preview {
            overflow: hidden;
        }

        /* Add styles for disabled button */
        .methods:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="nav">
            <div class="logo">
                <i class='bx bx-menu' id="btn"></i>
                <span><b>PDF - Modify</b></span>
            </div>

            <ul>
                <li><button class="methods" id="merge-button"><span><i class='bx bx-merge'></i>Merge</span></button>
                </li>
                <li><button class="methods" id="add-button"> <span><i class='bx bx-plus'></i>Add</span></button></li>
                <li><button class="methods" id="extract-button"><span><i class='bx bx-cut'></i>Extract</span></button>
                </li>
                <li><button class="methods" id="remove-button"> <span><i class='bx bx-trash'></i>Remove</span></button>
                </li>
                <li><button class="methods" id="shuffle-button" disabled><span><i
                                class='bx bx-shuffle'></i>Shuffle</span></button></li>

            </ul>
            <div class="git">
                <!-- <img class="pic" src="me.jpeg" alt="git" width="50px" height="50px"> -->
                <img class="pic" id="profile-pic" src="user.png" alt="git" width="50px" height="50px">

                <a href="" class="git-name">ranasthala-dev</a>
            </div>

        </div>
        <div class="main-container">

            <div class="main">
                <div class="nav-bar">
                    <ul class="nav-list">
                        <li><button class="nav-button" id="nav-home">Home</button></li>
                        <li><button class="nav-button" id="nav-shuffle">Go-Shuffle</button></li>
                        <li><button class="nav-button" id="nav-docs">Docs</button></li>
                    </ul>
                </div>
                <div class="uploads-container">
                    <div class="view vertical-preview">
                        <div class="uploads">
                            <div class="upload-box1 upload-box">
                                <div class="upload-btn1">
                                    <input type="file" id="file1" accept="application/pdf" />
                                    <label for="file1" class="round-upload" title="Upload PDF">+</label>
                                </div>
                                <div class="vertical-preview-box" id="pdf-preview-1"></div>
                            </div>
                            <div class="upload-box2 upload-box">
                                <div class="upload-btn2">
                                    <input type="file" id="file2" accept="application/pdf" />
                                    <label for="file2" class="round-upload" title="Upload PDF">+</label>
                                </div>
                                <div class="vertical-preview-box" id="pdf-preview-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="view horiontal-preview">

                        <label for="file3" class="round-upload" title="Upload PDF">+</label>
                        <input type="file" id="file3" class="" name="file3" accept="application/pdf" />
                        <div id="sortable" class="container"></div>
                    </div>
                    <div class="view docs-view">
                        <div class="docs-container">
                            <div class="docs-inner">
                                <div><b>Merge</b></div><br>
                                <div class="docs-box">
                                    <div class="description">
                                        Upload the PDFs in their respective slots — the second PDF will always
                                        be
                                        appended to the first.<br><br>

                                        Selections will not affect the merge process. To maintain
                                        simplicity and clarity in functionality, merging has been intentionally
                                        designed to combine PDFs in a fixed order — with all appended content
                                        added
                                        at the end.<br><br>

                                        This approach ensures consistent results and an intuitive experience.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="docs-container">
                            <div class="docs-inner">
                                <div><b>Add</b></div><br>
                                <div class="docs-box">
                                    <div class="description">
                                        Upload two PDFs in their respective slots. Select a page in the first PDF where
                                        you want to insert content.<br><br>

                                        You can optionally select specific pages from the second PDF. If no pages are
                                        selected in the second PDF, all its pages will be used.<br><br>

                                        The selected pages from the second PDF (or all pages if none selected) will be
                                        inserted after your chosen page in the first PDF, maintaining the order of the
                                        remaining pages.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="docs-container">
                            <div class="docs-inner">
                                <div><b>Extract</b></div><br>
                                <div class="docs-box">
                                    <div class="description">
                                        Upload one or both PDFs in their respective slots. Select the pages you want to
                                        extract from either or both PDFs.<br><br>

                                        The selected pages will be combined into a new PDF in the order they were
                                        selected. You can select pages from both PDFs to create a single new
                                        document.<br><br>

                                        This feature is useful for creating custom PDFs by combining specific pages from
                                        multiple documents.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="docs-container">
                            <div class="docs-inner">
                                <div><b>Remove</b></div><br>
                                <div class="docs-box">
                                    <div class="description">
                                        Upload one or both PDFs in their respective slots. Select the pages you want to
                                        remove from either or both PDFs.<br><br>

                                        The selected pages will be excluded from the new PDF, while all other pages will
                                        be preserved in their original order. You can select pages from both PDFs to
                                        remove them from the final document.<br><br>

                                        This feature is useful for cleaning up documents by removing unwanted pages
                                        while maintaining the structure of the remaining content.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="docs-container">
                            <div class="docs-inner">
                                <div><b>Shuffle</b></div><br>
                                <div class="docs-box">
                                    <div class="description">
                                        Upload a PDF and arrange its pages in any order you want using drag and
                                        drop.<br><br>

                                        Click the upload button to upload your PDF. Once uploaded, you'll see all pages
                                        displayed horizontally. Simply drag and drop the pages to arrange them in your
                                        desired order.<br><br>

                                        After arranging the pages, click the "Shuffle" button in the sidebar to download
                                        the PDF with the new page order. This feature is perfect for reorganizing
                                        documents or creating custom page sequences.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- pdf.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <!-- pdf-lib CDN -->
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

    <script>
        // toggle view -----------
        const views = {
            home: document.querySelector(".vertical-preview"),
            shuffle: document.querySelector(".horiontal-preview"),
            docs: document.querySelector(".docs-view")
        };

        const shuffleButton = document.getElementById('shuffle-button');

        function showView(viewKey) {
            Object.values(views).forEach(v => v.style.display = "none");
            views[viewKey].style.display = "block";

            // Enable/disable shuffle button based on view
            if (viewKey === 'shuffle') {
                shuffleButton.disabled = false;
                shuffleButton.onclick = downloadShuffled;
            } else {
                shuffleButton.disabled = true;
                shuffleButton.onclick = null;
            }
        }

        document.getElementById("nav-shuffle").addEventListener("click", () => showView("shuffle"));
        document.getElementById("nav-docs").addEventListener("click", () => showView("docs"));
        document.getElementById("nav-home").addEventListener("click", () => showView("home"));


        // notify ---------
        function showNotification(message, duration = 2000) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = message;
            document.body.appendChild(notif);

            // Trigger animation
            requestAnimationFrame(() => notif.classList.add('show'));

            // Remove after duration
            setTimeout(() => {
                notif.classList.remove('show');
                setTimeout(() => notif.remove(), 500); // wait for fade out
            }, duration);
        }

        // <!-- preview  -->
        const file1Input = document.getElementById('file1');
        const file2Input = document.getElementById('file2');
        const preview1 = document.getElementById('pdf-preview-1');
        const preview2 = document.getElementById('pdf-preview-2');

        let pdf1Selected = [];
        let pdf2Selected = [];
        let uploadedFile1 = null;
        let uploadedFile2 = null;

        file1Input.addEventListener('change', () => {
            pdf1Selected = [];
            uploadedFile1 = file1Input.files[0]; // <-- Save file here
            renderPDF(uploadedFile1, preview1, pdf1Selected, 'pdf1');
        });

        file2Input.addEventListener('change', () => {
            pdf2Selected = [];
            uploadedFile2 = file2Input.files[0]; // <-- Save file here
            renderPDF(uploadedFile2, preview2, pdf2Selected, 'pdf2');
        });
        async function renderPDF(file, container, selectionArray, tag) {
            container.innerHTML = '';
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                const page = await pdf.getPage(pageNum);
                const viewport = page.getViewport({ scale: 0.6 });
                const canvas = document.createElement('canvas');
                canvas.setAttribute('data-page', pageNum);
                canvas.setAttribute('data-tag', tag);

                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({ canvasContext: context, viewport }).promise;

                const wrapper = document.createElement('div');
                wrapper.classList.add('canvas-wrapper');
                wrapper.appendChild(canvas);
                container.appendChild(wrapper);

                canvas.addEventListener('click', () => {
                    const pageId = parseInt(canvas.dataset.page);
                    const list = tag === 'pdf1' ? pdf1Selected : pdf2Selected;

                    const index = list.indexOf(pageId);
                    if (index !== -1) {
                        list.splice(index, 1);
                        canvas.classList.remove('selected');
                    } else {
                        list.push(pageId);
                        canvas.classList.add('selected');
                    }

                    updateBadges(container, list);
                });
            }
        }
        function updateBadges(container, list) {
            const wrappers = container.querySelectorAll('.canvas-wrapper');
            wrappers.forEach(wrapper => {
                const badge = wrapper.querySelector('.selection-badge');
                if (badge) badge.remove();

                const canvas = wrapper.querySelector('canvas');
                const pageId = parseInt(canvas.dataset.page);
                const index = list.indexOf(pageId);
                if (index !== -1) {
                    const badge = document.createElement('div');
                    badge.classList.add('selection-badge');
                    badge.textContent = index + 1;
                    wrapper.appendChild(badge);
                }
            });
        }

        function logSelections() {
            console.log('pdf1:', pdf1Selected);
            console.log('pdf2:', pdf2Selected);
        }

        // Remove button functionality
        document.getElementById('remove-button').addEventListener('click', async () => {
            // Check if at least one PDF is uploaded
            if (!uploadedFile1 && !uploadedFile2) {
                showNotification('Please upload at least one PDF');
                return;
            }

            // Get selected pages from both PDFs
            const selectedPages = [...pdf1Selected, ...pdf2Selected];
            if (selectedPages.length === 0) {
                showNotification('Please select at least one page to remove');
                return;
            }

            try {
                const newPdf = await PDFLib.PDFDocument.create();

                // Process first PDF if uploaded
                if (uploadedFile1) {
                    const pdf1Bytes = await uploadedFile1.arrayBuffer();
                    const pdf1Doc = await PDFLib.PDFDocument.load(pdf1Bytes);

                    // Get all pages except selected ones
                    const pagesToKeep = Array.from(
                        { length: pdf1Doc.getPageCount() },
                        (_, i) => i + 1
                    ).filter(pageNum => !pdf1Selected.includes(pageNum));

                    // Copy non-selected pages from first PDF
                    if (pagesToKeep.length > 0) {
                        const pdf1Pages = await newPdf.copyPages(pdf1Doc,
                            pagesToKeep.map(pageNum => pageNum - 1));
                        pdf1Pages.forEach(page => newPdf.addPage(page));
                    }
                }

                // Process second PDF if uploaded
                if (uploadedFile2) {
                    const pdf2Bytes = await uploadedFile2.arrayBuffer();
                    const pdf2Doc = await PDFLib.PDFDocument.load(pdf2Bytes);

                    // Get all pages except selected ones
                    const pagesToKeep = Array.from(
                        { length: pdf2Doc.getPageCount() },
                        (_, i) => i + 1
                    ).filter(pageNum => !pdf2Selected.includes(pageNum));

                    // Copy non-selected pages from second PDF
                    if (pagesToKeep.length > 0) {
                        const pdf2Pages = await newPdf.copyPages(pdf2Doc,
                            pagesToKeep.map(pageNum => pageNum - 1));
                        pdf2Pages.forEach(page => newPdf.addPage(page));
                    }
                }

                // Save the new PDF
                const removedPdfBytes = await newPdf.save();

                // Create a download link
                const blob = new Blob([removedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'removed.pdf';
                link.click();
                URL.revokeObjectURL(url);

                showNotification('Pages successfully removed!');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error removing pages');
            }
        });

        // Extract button functionality
        document.getElementById('extract-button').addEventListener('click', async () => {
            // Check if at least one PDF is uploaded
            if (!uploadedFile1 && !uploadedFile2) {
                showNotification('Please upload at least one PDF');
                return;
            }

            // Get selected pages from both PDFs
            const selectedPages = [...pdf1Selected, ...pdf2Selected];
            if (selectedPages.length === 0) {
                showNotification('Please select at least one page to extract');
                return;
            }

            try {
                const newPdf = await PDFLib.PDFDocument.create();

                // Process first PDF if uploaded and has selected pages
                if (uploadedFile1 && pdf1Selected.length > 0) {
                    const pdf1Bytes = await uploadedFile1.arrayBuffer();
                    const pdf1Doc = await PDFLib.PDFDocument.load(pdf1Bytes);

                    // Copy selected pages from first PDF
                    const pdf1Pages = await newPdf.copyPages(pdf1Doc,
                        pdf1Selected.map(pageNum => pageNum - 1));
                    pdf1Pages.forEach(page => newPdf.addPage(page));
                }

                // Process second PDF if uploaded and has selected pages
                if (uploadedFile2 && pdf2Selected.length > 0) {
                    const pdf2Bytes = await uploadedFile2.arrayBuffer();
                    const pdf2Doc = await PDFLib.PDFDocument.load(pdf2Bytes);

                    // Copy selected pages from second PDF
                    const pdf2Pages = await newPdf.copyPages(pdf2Doc,
                        pdf2Selected.map(pageNum => pageNum - 1));
                    pdf2Pages.forEach(page => newPdf.addPage(page));
                }

                // Save the new PDF
                const extractedPdfBytes = await newPdf.save();

                // Create a download link
                const blob = new Blob([extractedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'extracted.pdf';
                link.click();
                URL.revokeObjectURL(url);

                showNotification('Pages successfully extracted!');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error extracting pages');
            }
        });

        // Merge button functionality
        document.getElementById('merge-button').addEventListener('click', async () => {
            if (!uploadedFile1 || !uploadedFile2) {
                showNotification('Please upload both PDFs first');
                return;
            }

            try {
                // Load both PDFs
                const pdf1Bytes = await uploadedFile1.arrayBuffer();
                const pdf2Bytes = await uploadedFile2.arrayBuffer();

                const pdf1Doc = await PDFLib.PDFDocument.load(pdf1Bytes);
                const pdf2Doc = await PDFLib.PDFDocument.load(pdf2Bytes);

                // Create a new PDF
                const newPdf = await PDFLib.PDFDocument.create();

                // Copy all pages from first PDF
                const pdf1Pages = await newPdf.copyPages(pdf1Doc,
                    Array.from({ length: pdf1Doc.getPageCount() }, (_, i) => i));
                pdf1Pages.forEach(page => newPdf.addPage(page));

                // Copy all pages from second PDF
                const pdf2Pages = await newPdf.copyPages(pdf2Doc,
                    Array.from({ length: pdf2Doc.getPageCount() }, (_, i) => i));
                pdf2Pages.forEach(page => newPdf.addPage(page));

                // Save the new PDF
                const mergedPdfBytes = await newPdf.save();

                // Create a download link
                const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'merged.pdf';
                link.click();
                URL.revokeObjectURL(url);

                showNotification('PDFs successfully merged!');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error merging PDFs');
            }
        });

        // Add button functionality
        document.getElementById('add-button').addEventListener('click', async () => {
            if (!uploadedFile1 || !uploadedFile2) {
                showNotification('Please upload both PDFs first');
                return;
            }

            if (pdf1Selected.length === 0) {
                showNotification('Please select a page in the first PDF');
                return;
            }

            try {
                // Load both PDFs
                const pdf1Bytes = await uploadedFile1.arrayBuffer();
                const pdf2Bytes = await uploadedFile2.arrayBuffer();

                const pdf1Doc = await PDFLib.PDFDocument.load(pdf1Bytes);
                const pdf2Doc = await PDFLib.PDFDocument.load(pdf2Bytes);

                // Create a new PDF
                const newPdf = await PDFLib.PDFDocument.create();

                // Copy all pages from first PDF up to the selected page
                const selectedPage = pdf1Selected[0];
                for (let i = 0; i < selectedPage; i++) {
                    const [page] = await newPdf.copyPages(pdf1Doc, [i]);
                    newPdf.addPage(page);
                }

                // Add selected pages from second PDF or all pages if none selected
                const pagesToAdd = pdf2Selected.length > 0 ? pdf2Selected : Array.from({ length: pdf2Doc.getPageCount() }, (_, i) => i + 1);
                for (const pageNum of pagesToAdd) {
                    const [page] = await newPdf.copyPages(pdf2Doc, [pageNum - 1]);
                    newPdf.addPage(page);
                }

                // Add remaining pages from first PDF
                for (let i = selectedPage; i < pdf1Doc.getPageCount(); i++) {
                    const [page] = await newPdf.copyPages(pdf1Doc, [i]);
                    newPdf.addPage(page);
                }

                // Save the new PDF
                const mergedPdfBytes = await newPdf.save();

                // Create a download link
                const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'merged.pdf';
                link.click();
                URL.revokeObjectURL(url);

                showNotification('PDF successfully created!');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error creating PDF');
            }
        });


        // profile pic
        const img = new Image();
        img.src = 'me.jpeg';

        img.onload = function () {
            document.getElementById('profile-pic').src = 'me.jpeg';
        };

        img.onerror = function () {
            document.getElementById('profile-pic').src = 'user.png';
        };

        // shuffle
        const upload = document.getElementById('file3');
        const sortable = document.getElementById('sortable');
        let currentPdfFile = null;

        upload.addEventListener('change', async (e) => {
            currentPdfFile = e.target.files[0];
            const buffer = await currentPdfFile.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

            sortable.innerHTML = '';

            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                const page = await pdf.getPage(pageNum);
                const viewport = page.getViewport({ scale: 0.3 });

                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                await page.render({
                    canvasContext: ctx, viewport
                }).promise;
                const box = document.createElement('div');
                box.className = 'page-box';
                box.draggable = true;
                box.dataset.page = pageNum;
                box.appendChild(canvas);

                addDragEvents(box);
                sortable.appendChild(box);
            }
        });

        function addDragEvents(box) {
            box.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', box.dataset.page);
                box.classList.add('dragging');
            });

            box.addEventListener('dragend', () => {
                box.classList.remove('dragging');
            });

            box.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            box.addEventListener('drop', (e) => {
                e.preventDefault();
                const draggedPage = e.dataTransfer.getData('text/plain');
                const draggedEl = document.querySelector(`[data-page="${draggedPage}"]`);

                if (draggedEl !== box) {
                    const allBoxes = Array.from(sortable.children);
                    const dropIndex = allBoxes.indexOf(box);
                    sortable.insertBefore(draggedEl, dropIndex > allBoxes.indexOf(draggedEl) ? box.nextSibling : box);
                }
            });
        }

        async function downloadShuffled() {
            if (!currentPdfFile) {
                showNotification('Please upload a PDF first');
                return;
            }

            try {
                // Get the new page order
                const newOrder = Array.from(sortable.children).map(box => parseInt(box.dataset.page));

                // Load the original PDF
                const arrayBuffer = await currentPdfFile.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

                // Create a new PDF
                const newPdf = await PDFLib.PDFDocument.create();

                // Copy pages in the new order
                for (const pageNum of newOrder) {
                    const [page] = await newPdf.copyPages(pdfDoc, [pageNum - 1]);
                    newPdf.addPage(page);
                }

                // Save the new PDF
                const shuffledPdfBytes = await newPdf.save();

                // Create download link
                const blob = new Blob([shuffledPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'shuffled.pdf';
                link.click();
                URL.revokeObjectURL(url);

                showNotification('PDF successfully shuffled!');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error creating shuffled PDF');
            }
        }
    </script>
</body>

</html>